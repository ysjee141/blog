<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>JMH(Java Microbenchmark Harness) 사용법 - happl’s Doodle</title>
<meta name="description" content="개발을 진행하다가 보면, 성능문제를 해결해야 하는 경우는 매우 많다. 성능 문제를 해결하기 위해서는 우선 성능을 측정해야하며, 성능을 측정하는 방법와 도구는 셀수도 없이 많다. 대부분의 경우 개발환경 또는 운영환경에 어플리케이션이 배포가 되고, Stress Test를 진행하여 성능을 측정한다. 이러한 방법은 매우 일반적이며 어플리케이션의 성능을 개선하기 위해서는 당연히 수행해야 하는 작업이다.">


  <meta name="author" content="Yoonseong JI">


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="happl's Doodle">
<meta property="og:title" content="JMH(Java Microbenchmark Harness) 사용법">
<meta property="og:url" content="https://ysjee141.github.io/blog/quality/java-benchmark/">


  <meta property="og:description" content="개발을 진행하다가 보면, 성능문제를 해결해야 하는 경우는 매우 많다. 성능 문제를 해결하기 위해서는 우선 성능을 측정해야하며, 성능을 측정하는 방법와 도구는 셀수도 없이 많다. 대부분의 경우 개발환경 또는 운영환경에 어플리케이션이 배포가 되고, Stress Test를 진행하여 성능을 측정한다. 이러한 방법은 매우 일반적이며 어플리케이션의 성능을 개선하기 위해서는 당연히 수행해야 하는 작업이다.">







  <meta property="article:published_time" content="2020-07-29T00:00:00+00:00">





  

  


<link rel="canonical" href="https://ysjee141.github.io/blog/quality/java-benchmark/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "happl",
      "url": "https://ysjee141.github.io/blog/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="happl's Doodle Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
<link rel="stylesheet" href="/blog/assets/css/syntax.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    <script src="/blog/assets/js/vendor/jquery/jquery-3.4.1.js"></script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.0/axios.min.js"></script>
  
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
  
    <script src="https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js"></script>
  
    <script src="/blog/assets/js/vendor/bluebird.js"></script>
  


    <!-- start custom head snippets -->
<meta name="google-site-verification" content="SO-0QxMtMMEgiaV3K59vtKNi2ucxcYXH9gROvXDOke0" />
<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          happl's Doodle
          <span class="site-subtitle">심심해서 끄적거리는 낙서장</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              
              <a data-link="Blog" href="/blog/">Blog</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="Tag" href="/blog/tag">Tag</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="Repos" href="/blog/github-repos">Repos</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="About" href="/blog/about">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {

    var _url = window.location.pathname;

    if( _url.indexOf("/tag") > -1 ) {
      $("[data-link='Tag']").addClass("hover");
    } else if( _url.indexOf("/github-repos") > -1 ) {
      $("[data-link='Repos']").addClass("hover");
    } else if( _url.indexOf("/about") > -1 ) {
      $("[data-link='About']").addClass("hover");
    } else {
      $("[data-link='Blog']").addClass("hover");
    }


  })
</script>

    <div class="initial-content">
      


<!--<button type="button" onclick="slideshow('/blog/quality/java-benchmark/')">Slide</button>-->
<!-- SlideShow Information -->

<textarea id="source" style="display: none">개발을 진행하다가 보면, 성능문제를 해결해야 하는 경우는 매우 많다. 성능 문제를 해결하기 위해서는 우선 성능을 측정해야하며, 성능을 측정하는 방법와 도구는 셀수도 없이 많다.<br>
대부분의 경우 개발환경 또는 운영환경에 어플리케이션이 배포가 되고, Stress Test를 진행하여 성능을 측정한다.<br>
이러한 방법은 매우 일반적이며 어플리케이션의 성능을 개선하기 위해서는 당연히 수행해야 하는 작업이다.

이러한 성능 도구는 어플리케이션의 기능 수행 측면에서의 성능 측정이고, 
일부 로직에 대한 성능을 측정하고 비교하기에는 무거운 감이 없지 않다.<br>
개발을 하다보면, 특정 코드에 대한 간단한 비교가 필요하기도 하고, 학습을 위해 각 코드에 대한 
성능을 비교해야 할 경우도 많이 있을 것이다. 이렇듯 코드에 대한 성능측정을 하기 위한 방법을 찾던 중 
JMH(Java Microbenchmark Harness)란 도구를 알게 되어 사용법을 정리해 본다.

참고로, JMH는 Oracle의 JIT Compiler 개발자가 만든 것이기 때문에 
타 Benchmark Framework 보다 신뢰할 수 있다는 장점이 존재한다.

## Maven 프로젝트 생성 및 Dependency 설정

JMH를 통해 벤치마킹 테스트를 하기 위해서는 Project를 생성해야 한다. 만약, 이미 만들어진 프로젝트에 
JMH을 사용하려면 Maven Dependency를 추가하면 된다.

**Maven Project 생성**
```bash
$ mvn archetype:generate \
    -DinteractiveMode=false \ 
    -DarchetypeGroupId=org.openjdk.jmh \ 
    -DarchetypeArtifactId=jmh-java-benchmark-archetype \ 
    -DgroupId=com.happl.test \
    -DartifactId=code-benchmark \
    -Dversion=1
```
**Maven Dependency**
```xml
  <dependency>
    <groupId>org.openjdk.jmh</groupId>
    <artifactId>jmh-core</artifactId>
    <version>1.19</version>
  </dependency>
  <dependency>
    <groupId>org.openjdk.jmh</groupId>
    <artifactId>jmh-generator-annprocess</artifactId>
    <version>1.19</version>
  </dependency>
```

## JMH를 통한 Benchmark 테스트

성능 측정을 위해서는 JMH에서 지원하는 Annotation을 사용하여 코드를 작성하면 된다. 예제는 아래와 같다.<br>
ArrayList에 데이터를 넣은 후 반복문을 돌리는 테스트 코드이다.
```java
@State(Scope.Thread)
@BenchmarkMode(Mode.AverageTime)
@OutputTimeUnit(TimeUnit.MILLISECONDS)
public class LoopTest {

    final LIMIT_COUNT = 10000;
    final List<Integer> array = new ArrayList<>();

	@Setup
	public void init() {
        // 성능 측정 전 사전에 필요한 작업
        for(int i = 0; i < LIMIT_COUNT; i++) {
            array.add(i);
        }
	}

	@Benchmark
	public void originLoopWithGetSize() {
        // 성능을 측정할 코드 작성
        int size = array.size();
        for(int i = 0; i < size; i++) {
            processor(i);
        }
	}

    Integer temp = 0;
    public void processor(Integer i) {
        temp = i;
    }

    public static void main(String[] args) throws IOException, RunnerException {
        Options opt = new OptionsBuilder()
                .include(LoopTest.class.getSimpleName())
                .warmupIterations(10)           // 사전 테스트 횟수
                .measurementIterations(10)      // 실제 측정 횟수
                .forks(1)                       // 
                .build();
        new Runner(opt).run();                  // 벤치마킹 시작
    }
}
``` 
SELECT CODE
FROM TBL_CODE
GROUP BY CODE



측정이 완료되면 다음과 같은 결과가 출력된다.
```bash
# Run complete. Total time: 00:01:43

Benchmark                       Mode  Cnt  Score   Error  Units
LoopTest.forEach                avgt   10  0.990 ± 0.096  ms/op
LoopTest.forEachByJdk8          avgt   10  0.703 ± 0.160  ms/op
LoopTest.forEachByStream        avgt   10  0.561 ± 0.057  ms/op
LoopTest.originLoop             avgt   10  0.634 ± 0.117  ms/op
LoopTest.originLoopWithGetSize  avgt   10  0.876 ± 0.093  ms/op
```

## Annotation 정리

### @BenchmarkMode
JMH는 벤치마크를 다양항 방법을 수행할 수 있으며, 이를 지정하기 위해 @BenchmarkMode를 사용한다. <br>
사용가능한 방법은 아래 참조

| Mode | Description |
| --- | --- |
| Throughput | 초당 작업수 측정, 기본값 |
| AverageTime | 작업이 수행되는 평균 시간을 측정 |
| SampleTime | 최대, 최소 시간 등 작업이 수행하는데 걸리는 시간을 측정
| SingleShotTime | 단일 작업 수행 소요 시간 측정, Cold Start(JVM 예열 없이) 수행하는데 적격 |
| All | 위 모든 시간을 측정 |

**예제 코드([http://tutorials.jenkov.com/java-performance/jmh.html](http://tutorials.jenkov.com/java-performance/jmh.html))**

```java
public class MyBenchmark {

    @Benchmark @BenchmarkMode(Mode.Throughput)
    public void testMethod() {
        // This is a demo/sample template for building your JMH benchmarks. Edit as needed.
        // Put your benchmark code here.

        int a = 1;
        int b = 2;
        int sum = a + b;
    }

}
```

### @OutputTimeUnit

벤치마크 결과를 출력할 시간 단위를 설정할 수 있으며, java.util.concurrent.TimeUnit 열거형을 통해 설정이 가능하다.

* NANOSECONDS(Default)
* MICROSECONDS
* MILLISECONDS
* SECONDS
* MINUTES
* HOURS
* DAYS

**예제 코드([http://tutorials.jenkov.com/java-performance/jmh.html](http://tutorials.jenkov.com/java-performance/jmh.html))**

```java
public class MyBenchmark {

    @Benchmark @BenchmarkMode(Mode.Throughput) @OutputTimeUnit(TimeUnit.MINUTES)
    public void testMethod() {
        // This is a demo/sample template for building your JMH benchmarks. Edit as needed.
        // Put your benchmark code here.

        int a = 1;
        int b = 2;
        int sum = a + b;
    }

}
```

### @State

JMH는 벤치마크에 사용되어지는 Argument의 상태를 지정할 수 있다. 벤치마크 테스트를 진행하다보면 상황에 따라
Argument가 항상 초기화 되어야 할 때도 있고, 값이 항상 유지되어야 할 경우도 있을텐데 이것을 가능하게 하는 것이
@State Annotation이며, 정의 가능한 Scope는 아래와 같다. 

| Scope | Description |
| --- | --- |
| Thread | Thread별로 인스턴스 생성 |
| Benchmark | 동일 테스트 내 모든 Thread에서 동일 Instance를 공유 (Multi-Threading 테스트) |
| Group | Thread 그룹마다 Instance를 생성 |

> @Steate Annotation이 적용되는 클래스는 다음과 같은 규칙을 준수해야 한다.
>* 반드시 Public 클래스로 선언되어야 한다. 만약 중첩 클래스인 경우에는 static로 선언되어야 한다.
>* Argument가 없는 생성자가 반드시 있어야 한다.
> 위 규칙을 준수하면 @State Annotation을 클래스에 적용하여 JMH가 인식하도록 할 수 있다.

**예제 코드([http://tutorials.jenkov.com/java-performance/jmh.html](http://tutorials.jenkov.com/java-performance/jmh.html))**

```java
public class MyBenchmark {

    @State(Scope.Thread)
    public static class MyState {
        public int a = 1;
        public int b = 2;
        public int sum ;
    }


    @Benchmark @BenchmarkMode(Mode.Throughput) @OutputTimeUnit(TimeUnit.MINUTES)
    public void testMethod(MyState state) {
        state.sum = state.a + state.b;
    }

}
```

### @Setup / @TearDown

@Setup 및 @TearDown Annotation은 상태 클래스의 Method에 적용이 가능하다. @Setup Annotation은 JMH에게 
벤치마크가 시작되기 전 상태 Object를 설정하기 위해 사용한다. JUnit의 @Before와 같은 역할을 한다고 이해하면 쉽다.
@TearDown Annotation은 벤치마크가 종료된 이후 상태 Object를 정리하기 위해 사용한다. JUnit의 @After와 같은 역할을 한다고 이해하자.<br>
@Setup / @TearDown이 적용된 Method의 실행시간은 벤치마크 시간에 포함되지 않는다.

@Setup / @TearDown은 Level Arugement의 설정이 가능하며 설정 가능한 값은 다음과 같다.

| Level | Description |
| --- | --- |
| Trial | 벤치마크를 실행할 때 마다 한번씩 호출하며, 실행은 전체 Fork를 의미한다. |
| Iteration | 벤치마크를 반복 할 때마다 한번씩 호출 |
| Invocation | 벤치마크를 메소드를 호출 할 때마다 호출 |

**예제 코드([http://tutorials.jenkov.com/java-performance/jmh.html](http://tutorials.jenkov.com/java-performance/jmh.html))**

```java
public class MyBenchmark {

    @State(Scope.Thread)
    public static class MyState {

        @Setup(Level.Trial)
        public void doSetup() {
            sum = 0;
            System.out.println("Do Setup");
        }

        @TearDown(Level.Trial)
        public void doTearDown() {
            System.out.println("Do TearDown");
        }

        public int a = 1;
        public int b = 2;
        public int sum ;
    }

    @Benchmark @BenchmarkMode(Mode.Throughput) @OutputTimeUnit(TimeUnit.MINUTES)
    public void testMethod(MyState state) {
        state.sum = state.a + state.b;
    }
}
```

### Dead Code를 주의하라

JVM의 경우 Method 등에서 계산된 결과를 반환하거나, 사용되지 않으면 사용하지 않는 코드라고 인식,
해당 코드를 제가하는 경우가 있으며, 이를 Dead Code라 한다. 이러한 코드를 벤치마킹시 
정확한 벤치마킹이 되지 않을 수 있으니 반드시 Dead Code를 작성하지 않도록 주의하자.

Dead Code의 예제는 아래와 같다.

```java
public class MyBenchmark {

    @Benchmark
    public void testMethod() {
        int a = 1;
        int b = 2;
        int sum = a + b;
    }

}
```

위 코드를 보면 testMethod() 내에서 a + b의 계산이 사용하는 코드가 존재하지 않는다.
이러한 경우 JVM은 해당 코드를 Dead Code라고 인식하고 해당 코드의 값이 사용되지 않기 
때문에 선언한 a와 b의 값 또한 사용되지 않는 것이기 때문에 같이 제거가 된다. 

결국 벤치마크 코드에는 아무런 코드도 존재하지 않는 것이 되며, 테스터가 이러한 부분을 인식하지 못한다면,
굉장히 성능이 좋은 코드라고 오해할 소지가 충분하다. 하지만 정작 벤치마크는 실행되지 않은 것과 같다.

이러한 Dead Code를 회피하기 위해서는 아래와 같은 방법을 사용하는 것이 좋다.
* Method가 결과 값을 Return 하도록 작성하라.
* 계산된 값을 JMH가 제공하는 "Black Hole" 함수를 통해 전달한다.

#### JMH가 제공하는 "Black Hole" 사용법 

JMH는 벤치마크 코드에서 계산된 값을 반환하지 않아도 JVM에서 마치 사용하는 것처럼 인식하게 하는 
Blackhole 방법을 제공하며, 예제는 다음과 같다.

```java
public class MyBenchmark {

    @Benchmark
   public void testMethod(Blackhole blackhole) {
        int a = 1;
        int b = 2;
        int sum = a + b;
        blackhole.consume(sum);
    }
}
```

위 코드에서 보면 벤치마크 Method 내 `blockhole.consume(sum)` 코드를 확인할 수 있다. Method에 
JMH가 제공하는 Blackhole 클래스를 Argument로 받고 해당 코드를 수행하면, Method 내에서 계산된 값을
넘겨주면 JVM에서는 계산된 값을 사용한 것으로 인식하여 정확한 측정이 가능하다. method 내 여러개의 계산된 값이
도출된다면 지속적으로 `consume()`를 호출하여 값을 전달하면 된다.

## 정리

JMH는 특정 클래스 또는 코드에 대한 벤치마크 테스트를 진행하는 것에 매우 좋은 방법으로 생각된다. 다만, 
테스트해야 할 범위가 크거나 다양한 Action 또는 Step이 필요한 경우에는 적절한 방법은 아닌 것으로 보여지며, 
이러한 경우에는 APM과 같은 어플리케이션 성능 테스트 솔루션을 활용하는 것이 좋을 것 같다.<br>
JUnit과 JMH를 조합하여, 코드를 빌드하는 과정에서 사전 테스트를 한다면 좀더 나은 코드 품질을 확보할 수 있지 않을까 생각해본다.</textarea>
<!-- // SlideShow Information -->
<div id="main" role="main">
  


  
  <article class="page no-author" itemscope itemtype="https://schema.org/CreativeWork">
  

  <!--<article class="page" itemscope itemtype="https://schema.org/CreativeWork">-->
    <meta itemprop="headline" content="JMH(Java Microbenchmark Harness) 사용법">
    <meta itemprop="description" content="개발을 진행하다가 보면, 성능문제를 해결해야 하는 경우는 매우 많다. 성능 문제를 해결하기 위해서는 우선 성능을 측정해야하며, 성능을 측정하는 방법와 도구는 셀수도 없이 많다.대부분의 경우 개발환경 또는 운영환경에 어플리케이션이 배포가 되고, Stress Test를 진행하여 성능을 측정한다.이러한 방법은 매우 일반적이며 어플리케이션의 성능을 개선하기 위해서는 당연히 수행해야 하는 작업이다.">
    <meta itemprop="datePublished" content="2020-07-29T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header style="padding-bottom: 25px;">
          <h1 id="page-title" class="page__title" itemprop="headline">JMH(Java Microbenchmark Harness) 사용법
</h1>
          
            <p class="page__meta">
              <i class="far fa-clock" aria-hidden="true"></i> 2020/07/29
              
              
              
              
              <i class="category__link">in <a href="/blog/category/quality">Quality</a></i>
            </p>
          
        </header>
      
      <span class="page-divider">
        <span class="one"></span>
        <span class="two"></span>
      </span>
      <ul class="page-tag-list">
        <strong><i class="fas fa-fw fa-tags" aria-hidden="true" style="font-size: .7em"></i>
        
        
        <li><a href="/blog/tag/java">#Java</a></li>
        
        
        <li><a href="/blog/tag/benchmark">#Benchmark</a></li>
        
        
        <li><a href="/blog/tag/jmh">#JMH</a></li>
        
        
        <li><a href="/blog/tag/performance">#Performance</a></li>
        
          <a href="http://hits.dwyl.com/ysjee141.github.ioqualityjava-benchmark" target="_blank"  class="page__meta__hits">
            <img src="http://hits.dwyl.com/ysjee141.github.ioqualityjava-benchmark.svg" />
          </a>
      </ul>

      <section class="page__content" itemprop="text">
        
        <p>개발을 진행하다가 보면, 성능문제를 해결해야 하는 경우는 매우 많다. 성능 문제를 해결하기 위해서는 우선 성능을 측정해야하며, 성능을 측정하는 방법와 도구는 셀수도 없이 많다.<br />
대부분의 경우 개발환경 또는 운영환경에 어플리케이션이 배포가 되고, Stress Test를 진행하여 성능을 측정한다.<br />
이러한 방법은 매우 일반적이며 어플리케이션의 성능을 개선하기 위해서는 당연히 수행해야 하는 작업이다.</p>

<p>이러한 성능 도구는 어플리케이션의 기능 수행 측면에서의 성능 측정이고, 
일부 로직에 대한 성능을 측정하고 비교하기에는 무거운 감이 없지 않다.<br />
개발을 하다보면, 특정 코드에 대한 간단한 비교가 필요하기도 하고, 학습을 위해 각 코드에 대한 
성능을 비교해야 할 경우도 많이 있을 것이다. 이렇듯 코드에 대한 성능측정을 하기 위한 방법을 찾던 중 
JMH(Java Microbenchmark Harness)란 도구를 알게 되어 사용법을 정리해 본다.</p>

<p>참고로, JMH는 Oracle의 JIT Compiler 개발자가 만든 것이기 때문에 
타 Benchmark Framework 보다 신뢰할 수 있다는 장점이 존재한다.</p>

<h2 id="maven-프로젝트-생성-및-dependency-설정">Maven 프로젝트 생성 및 Dependency 설정</h2>

<p>JMH를 통해 벤치마킹 테스트를 하기 위해서는 Project를 생성해야 한다. 만약, 이미 만들어진 프로젝트에 
JMH을 사용하려면 Maven Dependency를 추가하면 된다.</p>

<p><strong>Maven Project 생성</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mvn archetype:generate <span class="se">\</span>
    <span class="nt">-DinteractiveMode</span><span class="o">=</span><span class="nb">false</span> <span class="se">\ </span>
    <span class="nt">-DarchetypeGroupId</span><span class="o">=</span>org.openjdk.jmh <span class="se">\ </span>
    <span class="nt">-DarchetypeArtifactId</span><span class="o">=</span>jmh-java-benchmark-archetype <span class="se">\ </span>
    <span class="nt">-DgroupId</span><span class="o">=</span>com.happl.test <span class="se">\</span>
    <span class="nt">-DartifactId</span><span class="o">=</span>code-benchmark <span class="se">\</span>
    <span class="nt">-Dversion</span><span class="o">=</span>1
</code></pre></div></div>
<p><strong>Maven Dependency</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.openjdk.jmh<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jmh-core<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.19<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.openjdk.jmh<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jmh-generator-annprocess<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.19<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="jmh를-통한-benchmark-테스트">JMH를 통한 Benchmark 테스트</h2>

<p>성능 측정을 위해서는 JMH에서 지원하는 Annotation을 사용하여 코드를 작성하면 된다. 예제는 아래와 같다.<br />
ArrayList에 데이터를 넣은 후 반복문을 돌리는 테스트 코드이다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@State</span><span class="o">(</span><span class="nc">Scope</span><span class="o">.</span><span class="na">Thread</span><span class="o">)</span>
<span class="nd">@BenchmarkMode</span><span class="o">(</span><span class="nc">Mode</span><span class="o">.</span><span class="na">AverageTime</span><span class="o">)</span>
<span class="nd">@OutputTimeUnit</span><span class="o">(</span><span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoopTest</span> <span class="o">{</span>

    <span class="kd">final</span> <span class="no">LIMIT_COUNT</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">;</span>
    <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="nd">@Setup</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 성능 측정 전 사전에 필요한 작업</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="no">LIMIT_COUNT</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">array</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
	<span class="o">}</span>

	<span class="nd">@Benchmark</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">originLoopWithGetSize</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 성능을 측정할 코드 작성</span>
        <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">processor</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
	<span class="o">}</span>

    <span class="nc">Integer</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">processor</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">RunnerException</span> <span class="o">{</span>
        <span class="nc">Options</span> <span class="n">opt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OptionsBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="nc">LoopTest</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">())</span>
                <span class="o">.</span><span class="na">warmupIterations</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>           <span class="c1">// 사전 테스트 횟수</span>
                <span class="o">.</span><span class="na">measurementIterations</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>      <span class="c1">// 실제 측정 횟수</span>
                <span class="o">.</span><span class="na">forks</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>                       <span class="c1">// </span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">Runner</span><span class="o">(</span><span class="n">opt</span><span class="o">).</span><span class="na">run</span><span class="o">();</span>                  <span class="c1">// 벤치마킹 시작</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>SELECT CODE
FROM TBL_CODE
GROUP BY CODE</p>

<p>측정이 완료되면 다음과 같은 결과가 출력된다.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run complete. Total time: 00:01:43</span>

Benchmark                       Mode  Cnt  Score   Error  Units
LoopTest.forEach                avgt   10  0.990 ± 0.096  ms/op
LoopTest.forEachByJdk8          avgt   10  0.703 ± 0.160  ms/op
LoopTest.forEachByStream        avgt   10  0.561 ± 0.057  ms/op
LoopTest.originLoop             avgt   10  0.634 ± 0.117  ms/op
LoopTest.originLoopWithGetSize  avgt   10  0.876 ± 0.093  ms/op
</code></pre></div></div>

<h2 id="annotation-정리">Annotation 정리</h2>

<h3 id="benchmarkmode">@BenchmarkMode</h3>
<p>JMH는 벤치마크를 다양항 방법을 수행할 수 있으며, 이를 지정하기 위해 @BenchmarkMode를 사용한다. <br />
사용가능한 방법은 아래 참조</p>

<table>
  <thead>
    <tr>
      <th>Mode</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Throughput</td>
      <td>초당 작업수 측정, 기본값</td>
    </tr>
    <tr>
      <td>AverageTime</td>
      <td>작업이 수행되는 평균 시간을 측정</td>
    </tr>
    <tr>
      <td>SampleTime</td>
      <td>최대, 최소 시간 등 작업이 수행하는데 걸리는 시간을 측정</td>
    </tr>
    <tr>
      <td>SingleShotTime</td>
      <td>단일 작업 수행 소요 시간 측정, Cold Start(JVM 예열 없이) 수행하는데 적격</td>
    </tr>
    <tr>
      <td>All</td>
      <td>위 모든 시간을 측정</td>
    </tr>
  </tbody>
</table>

<p><strong>예제 코드(<a href="http://tutorials.jenkov.com/java-performance/jmh.html">http://tutorials.jenkov.com/java-performance/jmh.html</a>)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBenchmark</span> <span class="o">{</span>

    <span class="nd">@Benchmark</span> <span class="nd">@BenchmarkMode</span><span class="o">(</span><span class="nc">Mode</span><span class="o">.</span><span class="na">Throughput</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// This is a demo/sample template for building your JMH benchmarks. Edit as needed.</span>
        <span class="c1">// Put your benchmark code here.</span>

        <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="outputtimeunit">@OutputTimeUnit</h3>

<p>벤치마크 결과를 출력할 시간 단위를 설정할 수 있으며, java.util.concurrent.TimeUnit 열거형을 통해 설정이 가능하다.</p>

<ul>
  <li>NANOSECONDS(Default)</li>
  <li>MICROSECONDS</li>
  <li>MILLISECONDS</li>
  <li>SECONDS</li>
  <li>MINUTES</li>
  <li>HOURS</li>
  <li>DAYS</li>
</ul>

<p><strong>예제 코드(<a href="http://tutorials.jenkov.com/java-performance/jmh.html">http://tutorials.jenkov.com/java-performance/jmh.html</a>)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBenchmark</span> <span class="o">{</span>

    <span class="nd">@Benchmark</span> <span class="nd">@BenchmarkMode</span><span class="o">(</span><span class="nc">Mode</span><span class="o">.</span><span class="na">Throughput</span><span class="o">)</span> <span class="nd">@OutputTimeUnit</span><span class="o">(</span><span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// This is a demo/sample template for building your JMH benchmarks. Edit as needed.</span>
        <span class="c1">// Put your benchmark code here.</span>

        <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="state">@State</h3>

<p>JMH는 벤치마크에 사용되어지는 Argument의 상태를 지정할 수 있다. 벤치마크 테스트를 진행하다보면 상황에 따라
Argument가 항상 초기화 되어야 할 때도 있고, 값이 항상 유지되어야 할 경우도 있을텐데 이것을 가능하게 하는 것이
@State Annotation이며, 정의 가능한 Scope는 아래와 같다.</p>

<table>
  <thead>
    <tr>
      <th>Scope</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Thread</td>
      <td>Thread별로 인스턴스 생성</td>
    </tr>
    <tr>
      <td>Benchmark</td>
      <td>동일 테스트 내 모든 Thread에서 동일 Instance를 공유 (Multi-Threading 테스트)</td>
    </tr>
    <tr>
      <td>Group</td>
      <td>Thread 그룹마다 Instance를 생성</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>@Steate Annotation이 적용되는 클래스는 다음과 같은 규칙을 준수해야 한다.</p>
  <ul>
    <li>반드시 Public 클래스로 선언되어야 한다. 만약 중첩 클래스인 경우에는 static로 선언되어야 한다.</li>
    <li>Argument가 없는 생성자가 반드시 있어야 한다.
위 규칙을 준수하면 @State Annotation을 클래스에 적용하여 JMH가 인식하도록 할 수 있다.</li>
  </ul>
</blockquote>

<p><strong>예제 코드(<a href="http://tutorials.jenkov.com/java-performance/jmh.html">http://tutorials.jenkov.com/java-performance/jmh.html</a>)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBenchmark</span> <span class="o">{</span>

    <span class="nd">@State</span><span class="o">(</span><span class="nc">Scope</span><span class="o">.</span><span class="na">Thread</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyState</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">sum</span> <span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Benchmark</span> <span class="nd">@BenchmarkMode</span><span class="o">(</span><span class="nc">Mode</span><span class="o">.</span><span class="na">Throughput</span><span class="o">)</span> <span class="nd">@OutputTimeUnit</span><span class="o">(</span><span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMethod</span><span class="o">(</span><span class="nc">MyState</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span><span class="o">.</span><span class="na">sum</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">a</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="na">b</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="setup--teardown">@Setup / @TearDown</h3>

<p>@Setup 및 @TearDown Annotation은 상태 클래스의 Method에 적용이 가능하다. @Setup Annotation은 JMH에게 
벤치마크가 시작되기 전 상태 Object를 설정하기 위해 사용한다. JUnit의 @Before와 같은 역할을 한다고 이해하면 쉽다.
@TearDown Annotation은 벤치마크가 종료된 이후 상태 Object를 정리하기 위해 사용한다. JUnit의 @After와 같은 역할을 한다고 이해하자.<br />
@Setup / @TearDown이 적용된 Method의 실행시간은 벤치마크 시간에 포함되지 않는다.</p>

<p>@Setup / @TearDown은 Level Arugement의 설정이 가능하며 설정 가능한 값은 다음과 같다.</p>

<table>
  <thead>
    <tr>
      <th>Level</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Trial</td>
      <td>벤치마크를 실행할 때 마다 한번씩 호출하며, 실행은 전체 Fork를 의미한다.</td>
    </tr>
    <tr>
      <td>Iteration</td>
      <td>벤치마크를 반복 할 때마다 한번씩 호출</td>
    </tr>
    <tr>
      <td>Invocation</td>
      <td>벤치마크를 메소드를 호출 할 때마다 호출</td>
    </tr>
  </tbody>
</table>

<p><strong>예제 코드(<a href="http://tutorials.jenkov.com/java-performance/jmh.html">http://tutorials.jenkov.com/java-performance/jmh.html</a>)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBenchmark</span> <span class="o">{</span>

    <span class="nd">@State</span><span class="o">(</span><span class="nc">Scope</span><span class="o">.</span><span class="na">Thread</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyState</span> <span class="o">{</span>

        <span class="nd">@Setup</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">Trial</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSetup</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Do Setup"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@TearDown</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">Trial</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTearDown</span><span class="o">()</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Do TearDown"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">sum</span> <span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Benchmark</span> <span class="nd">@BenchmarkMode</span><span class="o">(</span><span class="nc">Mode</span><span class="o">.</span><span class="na">Throughput</span><span class="o">)</span> <span class="nd">@OutputTimeUnit</span><span class="o">(</span><span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMethod</span><span class="o">(</span><span class="nc">MyState</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span><span class="o">.</span><span class="na">sum</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">a</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="na">b</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="dead-code를-주의하라">Dead Code를 주의하라</h3>

<p>JVM의 경우 Method 등에서 계산된 결과를 반환하거나, 사용되지 않으면 사용하지 않는 코드라고 인식,
해당 코드를 제가하는 경우가 있으며, 이를 Dead Code라 한다. 이러한 코드를 벤치마킹시 
정확한 벤치마킹이 되지 않을 수 있으니 반드시 Dead Code를 작성하지 않도록 주의하자.</p>

<p>Dead Code의 예제는 아래와 같다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBenchmark</span> <span class="o">{</span>

    <span class="nd">@Benchmark</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>위 코드를 보면 testMethod() 내에서 a + b의 계산이 사용하는 코드가 존재하지 않는다.
이러한 경우 JVM은 해당 코드를 Dead Code라고 인식하고 해당 코드의 값이 사용되지 않기 
때문에 선언한 a와 b의 값 또한 사용되지 않는 것이기 때문에 같이 제거가 된다.</p>

<p>결국 벤치마크 코드에는 아무런 코드도 존재하지 않는 것이 되며, 테스터가 이러한 부분을 인식하지 못한다면,
굉장히 성능이 좋은 코드라고 오해할 소지가 충분하다. 하지만 정작 벤치마크는 실행되지 않은 것과 같다.</p>

<p>이러한 Dead Code를 회피하기 위해서는 아래와 같은 방법을 사용하는 것이 좋다.</p>
<ul>
  <li>Method가 결과 값을 Return 하도록 작성하라.</li>
  <li>계산된 값을 JMH가 제공하는 “Black Hole” 함수를 통해 전달한다.</li>
</ul>

<h4 id="jmh가-제공하는-black-hole-사용법">JMH가 제공하는 “Black Hole” 사용법</h4>

<p>JMH는 벤치마크 코드에서 계산된 값을 반환하지 않아도 JVM에서 마치 사용하는 것처럼 인식하게 하는 
Blackhole 방법을 제공하며, 예제는 다음과 같다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBenchmark</span> <span class="o">{</span>

    <span class="nd">@Benchmark</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMethod</span><span class="o">(</span><span class="nc">Blackhole</span> <span class="n">blackhole</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
        <span class="n">blackhole</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위 코드에서 보면 벤치마크 Method 내 <code class="language-plaintext highlighter-rouge">blockhole.consume(sum)</code> 코드를 확인할 수 있다. Method에 
JMH가 제공하는 Blackhole 클래스를 Argument로 받고 해당 코드를 수행하면, Method 내에서 계산된 값을
넘겨주면 JVM에서는 계산된 값을 사용한 것으로 인식하여 정확한 측정이 가능하다. method 내 여러개의 계산된 값이
도출된다면 지속적으로 <code class="language-plaintext highlighter-rouge">consume()</code>를 호출하여 값을 전달하면 된다.</p>

<h2 id="정리">정리</h2>

<p>JMH는 특정 클래스 또는 코드에 대한 벤치마크 테스트를 진행하는 것에 매우 좋은 방법으로 생각된다. 다만, 
테스트해야 할 범위가 크거나 다양한 Action 또는 Step이 필요한 경우에는 적절한 방법은 아닌 것으로 보여지며, 
이러한 경우에는 APM과 같은 어플리케이션 성능 테스트 솔루션을 활용하는 것이 좋을 것 같다.<br />
JUnit과 JMH를 조합하여, 코드를 빌드하는 과정에서 사전 테스트를 한다면 좀더 나은 코드 품질을 확보할 수 있지 않을까 생각해본다.</p>

        

        
        <span class="page-divider" style="margin-top: 50px;">
          <span class="one"></span>
          <span class="two"></span>
        </span>
        <table class="page__meta__additional">
          
          
          <tr>
            <th>참고자료</th>
            <td>
              <ul>
                
                
                <li><a href="https://medium.com/@devAsterisk/jmh-java-benchmark-tool-4f7a27eb3fa3" target="_blank">https://medium.com/@devAsterisk/jmh-java-benchmark-tool-4f7a27eb3fa3</a></li>
                
                
                
                <li><a href="http://tutorials.jenkov.com/java-performance/jmh.html#state-scope" target="_blank">http://tutorials.jenkov.com/java-performance/jmh.html#state-scope</a></li>
                
                
              </ul>
            </td>
          </tr>
          
        </table>
        

      </section>

      

      
  <nav class="pagination">
    
      <a href="/blog/server-side/ContextRefreshedEvent/" class="pagination--pager" title="Spring Boot Application Context Event
">< PREVIOUS POST</a>
    
    
      <a href="/blog/my%20story/my-story/" class="pagination--pager" title="블로그를 시작하며…
">NEXT POST ></a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">댓글 남기기</h4>
      <section id="utterances-comments"></section>
    
</div>

    
  </article>

  
  
    
      <div class="page__related no-author">
    
    <!--<div class="page__related">-->
      <h4 class="page__related-title">참고</h4>
      <div class="grid__wrapper">
        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/dev%20tools/intellij-springboot-docker/" rel="permalink">Spring Boot를 Docker 환경으로 개발/디버깅 하기
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/08/19
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">Spring Boot를 Docker 환경에서 개발 및 디버깅을 하기 위한 방법을 정리한다.
</p>
    
    
    
    <a href="/blog/tag/spring%20boot" class="page__meta__tag">#Spring Boot</a>
    
    
    
    <a href="/blog/tag/intellij" class="page__meta__tag">#IntelliJ</a>
    
    
    
    <a href="/blog/tag/devtools" class="page__meta__tag">#Devtools</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/server-side/DynamicMyBatisMapperScanner/" rel="permalink">다중 데이터 소스를 통한 동적 MyBatis Mapper Scanner 생성
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/08/04
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">어플리케이션을 개발하다보면 다중 Data Source를 사용해야 하는 경우가 생각보다 많다.
일반적으로 MyBatis를 통해 Database 개발을 하기 위해서는 보통은 다음과 같은 절차를 통해 개발을 진행한다.

  Data Source 정의
  SessionFactory / S...</p>
    
    
    
    <a href="/blog/tag/springboot" class="page__meta__tag">#SpringBoot</a>
    
    
    
    <a href="/blog/tag/mybatis" class="page__meta__tag">#MyBatis</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/server-side/BeanDefinitionPostProcessor/" rel="permalink">BeanDefinitionRegistryPostProcessor의 사용
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/08/03
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">Spring에서 어플리케이션이 시작될 때 동적으로 Bean을 생성하기 위해서는 다양한 방법이 존재한다.
앞서에는 Application Context 의 Event Listener를 통해 동적 Bean을 생성하는 방법을 소개한 적이 있는데, 
이번에는  BeanDefinitionRe...</p>
    
    
    
    <a href="/blog/tag/springboot" class="page__meta__tag">#SpringBoot</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/my%20story/my-story/" rel="permalink">블로그를 시작하며…
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/07/29
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">요즘 개발자들은 누구라 할 것 없이 블로그를 하는 것 같습니다.
덕분에 참고할 자료가 많아져서 개발하기가 많이 수월해졌고 저 또한 
이러한 블로그들을 참고하면서 개발을 진행하고, 지식을 습득하고 있습니다.
</p>
    
    
    
    <a href="/blog/tag/my%20story" class="page__meta__tag">#My Story</a>
    
  </article>
</div>

        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="검색어를 입력하세요..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow" style="display: inline-block">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/ysjee141" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://instagram.com/ysjee141" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright" style="display: inline-block">&copy; 2020 HAPPL. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>




<script src="/blog/assets/js/lunr/lunr.min.js"></script>
<script src="/blog/assets/js/lunr/lunr-store.js"></script>
<script src="/blog/assets/js/lunr/lunr-en.js"></script>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162766344-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-162766344-1');
</script>


    <style>
    .utterances {
        width: 100%;
        max-width: none;
    }
</style>
<script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'ysjee141/blog');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  



<script src="/blog/assets/js/_extend.js"></script>
<script src="/blog/assets/js/vendor/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad:true,
    theme: "forest",
    fontFamily: "D2Coding"
  });
  mermaid.init(undefined, '.language-mermaid');
</script>

  </body>
</html>
