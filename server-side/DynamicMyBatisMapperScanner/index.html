<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>다중 데이터 소스를 통한 동적 MyBatis Mapper Scanner 생성 - happl’s Doodle</title>
<meta name="description" content="어플리케이션을 개발하다보면 다중 Data Source를 사용해야 하는 경우가 생각보다 많다. 일반적으로 MyBatis를 통해 Database 개발을 하기 위해서는 보통은 다음과 같은 절차를 통해 개발을 진행한다.    Data Source 정의   SessionFactory / SessionTemplate 정의 - 선언한 Data Source 연결   TransactionManager 정의 - 선언한 Data Source 연결   Mapper Interface를 통해 Database 사용">


  <meta name="author" content="Yoonseong JI">


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="happl's Doodle">
<meta property="og:title" content="다중 데이터 소스를 통한 동적 MyBatis Mapper Scanner 생성">
<meta property="og:url" content="https://ysjee141.github.io/blog/server-side/DynamicMyBatisMapperScanner/">


  <meta property="og:description" content="어플리케이션을 개발하다보면 다중 Data Source를 사용해야 하는 경우가 생각보다 많다. 일반적으로 MyBatis를 통해 Database 개발을 하기 위해서는 보통은 다음과 같은 절차를 통해 개발을 진행한다.    Data Source 정의   SessionFactory / SessionTemplate 정의 - 선언한 Data Source 연결   TransactionManager 정의 - 선언한 Data Source 연결   Mapper Interface를 통해 Database 사용">







  <meta property="article:published_time" content="2020-08-04T00:00:00+00:00">





  

  


<link rel="canonical" href="https://ysjee141.github.io/blog/server-side/DynamicMyBatisMapperScanner/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "happl",
      "url": "https://ysjee141.github.io/blog/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="happl's Doodle Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
<link rel="stylesheet" href="/blog/assets/css/syntax.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    <script src="/blog/assets/js/vendor/jquery/jquery-3.4.1.js"></script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.0/axios.min.js"></script>
  
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
  
    <script src="https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js"></script>
  
    <script src="/blog/assets/js/vendor/bluebird.js"></script>
  


    <!-- start custom head snippets -->
<meta name="google-site-verification" content="SO-0QxMtMMEgiaV3K59vtKNi2ucxcYXH9gROvXDOke0" />
<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          happl's Doodle
          <span class="site-subtitle">심심해서 끄적거리는 낙서장</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              
              <a data-link="Blog" href="/blog/">Blog</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="Tag" href="/blog/tag">Tag</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="Repos" href="/blog/github-repos">Repos</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="About" href="/blog/about">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {

    var _url = window.location.pathname;

    if( _url.indexOf("/tag") > -1 ) {
      $("[data-link='Tag']").addClass("hover");
    } else if( _url.indexOf("/github-repos") > -1 ) {
      $("[data-link='Repos']").addClass("hover");
    } else if( _url.indexOf("/about") > -1 ) {
      $("[data-link='About']").addClass("hover");
    } else {
      $("[data-link='Blog']").addClass("hover");
    }


  })
</script>

    <div class="initial-content">
      


<!--<button type="button" onclick="slideshow('/blog/server-side/DynamicMyBatisMapperScanner/')">Slide</button>-->
<!-- SlideShow Information -->

<textarea id="source" style="display: none">어플리케이션을 개발하다보면 다중 Data Source를 사용해야 하는 경우가 생각보다 많다.<br>
일반적으로 MyBatis를 통해 Database 개발을 하기 위해서는 보통은 다음과 같은 절차를 통해 개발을 진행한다.
1. Data Source 정의
2. SessionFactory / SessionTemplate 정의 - 선언한 Data Source 연결
3. TransactionManager 정의 - 선언한 Data Source 연결
4. Mapper Interface를 통해 Database 사용

Data Source가 추가되면 위 절차와 같은 작업을 반복해서 설정한다. 이러한 과정은 의외로 귀찮고, 불편한 작업이다.
이를 해결하기 위해서 DataSource 정의만을 통해 위 작업을 자동화 하는 것을 시도해보았다.

## 핵심

동적 Bean 생성의 핵심은 언제 Bean을 생성하여 등록할 것인가? 일 것이다. 동적 Bean을 생성하기 위해서는 아래와 같은 다양한 방법이 있다.
* Bean Hooker Interface
    * BeanDefinitionRegistryPostProcessor: Bean 정의를 등록하는 것에 초점이 맞춰진 Interface
    * BeanFactoryPostProcessor: 빈 정의 자체를 재정의하거나 Property를 추가하기 위해 사용
    * BeanPostProcessor: Instance 화 된 Bean을 변경을 하기 위해 사용<br>
    ※ `BeanDefinitionRegistryPostProcessor`,`BeanFactoryPostProcessor`는 Bean이 Instance 화 되기 전에 호출됨
* Application Context Event
    * ContextRefreshedEvent: ApplicationContext를 초기화 하거나, Refresh 할 경우 발생
    * ContextStartedEvent: ApplicationContext를 start()하여 LifeCycle이 시작되는 시점에 발생
    * ContextStoppedEvent: ApplicationContext를 stop()하여 LifeCycle이 정지되는 시점에 발생
    * ContextClosedEvent: ApplicationContext를 close()하여 LifeCycle이 종료되는 시점에 발생

이번 포스팅에서는 `BeanDefinitionRegistryPostProcessor`를 활용하여 진행할 생각이다.

`BeanDefinitionRegistryPostProcessor`는 아래와 같이 사용이 가능하며, 
자세한 내용은 ['BeanDefinitionRegistryPostProcessor의 사용'](/blog/server-side/BeanDefinitionPostProcessor/){:target="_blank"}을 통해
확인할 수 있다. (아직 많은 부분의 수정이 필요하지만...)

```java
public class MapperBeanPostProcessor implements BeanDefinitionRegistryPostProcessor {
    @Override
	public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanFactory) throws BeansException {
        // BeanDefinition을 통해 Bean을 추가할 경우 이용
	}
	@Override
	public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException {
        // SingleTone Bean을 추가할 경우 이용
	}
}
```

## 구현

### Data Source Property Class 

이번 포스팅에서 다룰 예제는 정의된 Data Source를 통해 동적 Bean을 생성하는 것이다. 따라서 Data Source를 정의하기 위한
방법이 필요하며, 다중 Data Source의 정의가 가능해야 하기 때문에 아래와 같이 List 형식의 Property Class를 작성한다.
```java
public class RepoConfig extends ArrayList<RepoConfig.DsConfig> {

  public static RepoConfig init(Environment environment, String prefix) {
    return Binder.get(environment).bind(prefix, RepoConfig.class).get();
  }

  public static class DsConfig {
    private String name;
    private Map<String, String> dataSource;

    private MapperOrder order;

    public MapperOrder getOrder() {
      return order;
    }

    public void setOrder(MapperOrder order) {
      this.order = order;
    }

    public String getName() {
      return name;
    }

    public String getName(BEAN_TYPE beanType) {
      return this.name.concat(beanType.getSuffix());
    }

    public String getMapperLocation() {
      return "classpath*:/mapper/" + this.name + "/*.xml";
    }

    public void setName(String name) {
      this.name = name;
    }

    public Map<String, String> getDataSource() {
      return dataSource;
    }

    public void setDataSource(Map<String, String> dataSource) {
      this.dataSource = dataSource;
    }
  }
}
```

`BeanDefinitionRegistryPostProcessor`는 위에서 설명한바와 같이 Bean Instance화 되기 전에 호출이 되기 때문에,
`@ConfigurationProperties` Annotation을 통해 Property를 가져와 사용할 수가 없었다.
따라서 Processor Bean 생성시 Environment를 전달받아 prefix를 통해 직접 Property를 가져와 Binding하도록 하였다.
```java
public static RepoConfig init(Environment environment, String prefix) {
    return Binder.get(environment).bind(prefix, RepoConfig.class).get();
}
```
물론 Processor가 아닌 다른 서비스 로직에서 사용하기 위해서는 AutoConfiguration으로 설정하여 사용도 가능하다.

실제 Data Source 정보를 저장하기 위해서 내부에 Sub Class를 생성하고, Property Class는 ArrayList<T>를 상속 받고, 
Generic을 Sub Class로 지정하였다. 다음과 같이 YAML 또는 Properties 파일애 Data Source 정보를 설정하면, 
Property Class에 정보가 주입된다.
```yaml
datasource3:
  - name: datasourceOne
    order: 1
    data-source:
      jdbcUrl: jdbc:h2:file:d:/test_db;AUTO_SERVER=TRUE
      username: test
      password: test
      driverClassName: org.h2.Driver
      maximumPoolSize: 20
```
```java
// Annotation을 통한 Property 주입
@Bean
@ConfigurationProperties(prefix = "datasource")
public RepoConfig getConfig() {
    return new RepoConfig();
}

// RepoConfig.init() Method를 통해 주입
@Bean
public RepoConfig getConfig(Environment env) {
    return RepoConfig.init(env, "datasource3");
}
```

### BeanDefinitionRegistryPostProcessor 

`BeanDefinitionRegistryPostProcessor` 사용한 결정적인 이유는 어플리케이션 내 `@MapperScan` Annotation을 선언하지 않고,
Mapper Interface 들을 Scan 하기 위함이다. PostProcessor가 아닌 Application Context Event Listener를 통해 기능을 구현하였더니,
Bean Instance 화 과정에서 Mapper Interface를 Autowired 하는 과정에서 오류가 발생하고, 어플리케이션이 종료되었다.

이에 Bean Instance 화 이전에 MapperScanner를 생성하여, Mapper Interface를 Scan 하기 위해 PostProcessor를 이용하니,
위와 같은 문제가 해결되었다.

PostProcessor는 아래와 같이 개발할 수 있다.
```java
public class MapperBeanPostProcessor implements BeanDefinitionRegistryPostProcessor {

	private final RepoConfig repo;

	public MapperBeanPostProcessor(RepoConfig repo) {
		this.repo = repo;
	}

	@Override
	public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanFactory) throws BeansException {
		repo.forEach((v) -> {
			registerDataSource(beanFactory, v);         // DataSource 등록
			registerSqlSessionFactory(beanFactory, v);  // SqlSessionFactory
			registerSqlSessionTemplate(beanFactory, v); // SqlSessionTemplate
			registerTransactionManager(beanFactory, v); // TransactionManager
			registerMapperScanner(beanFactory, v);      // MapperScannerConfigurer
		});
	}

	@Override
	public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException {
    }

	private void registerDataSource(
			BeanDefinitionRegistry registry, RepoConfig.DsConfig config
	) {
        // Data Source Bean 등록
        // Bean 생성 및 등록 Sample Code 
        GenericBeanDefinition dataSourceBeanDefinition = new GenericBeanDefinition();
        dataSourceBeanDefinition.setBeanClass(HikariDataSource.class);
        dataSourceBeanDefinition.setPropertyValues(
            new MutablePropertyValues(config.getDataSource())
        );

        registry.registerBeanDefinition(
            config.getName(RepoConfig.BEAN_TYPE.DATASOURCE),
            dataSourceBeanDefinition
        );
	}

	private void registerSqlSessionFactory(BeanDefinitionRegistry registry, RepoConfig.DsConfig config) {
		// SessionFactory Bean 등록
	}

	private void registerSqlSessionTemplate(BeanDefinitionRegistry registry, RepoConfig.DsConfig config) {
		// SessionTemplate Bean 등록
	}

	private void registerTransactionManager(BeanDefinitionRegistry registry, RepoConfig.DsConfig config) {
		// TransactionManager Bean 등록
	}

	private void registerMapperScanner(BeanDefinitionRegistry registry, RepoConfig.DsConfig config) {
		// MapperScanner Bean 등록
	}
}
```

### AutoConfiguration

`BeanDefinitionRegistryPostProcessor`의 사용을 위해서는 PostProcessor 또한 Bean으로 등록해주어야 한다.<br>
아래와 같이 사용이 가능하다.

```java
@Configuration
@ConditionalOnPropertyForList(prefix = MapperConfig.PROPERTY_PREFIX)
public class MapperConfig {

	static final String PROPERTY_PREFIX = "datasource3";

	@Bean
	public BeanDefinitionRegistryPostProcessor postProcessor(Environment environment) {
		try {
			return new MapperBeanPostProcessor(
					RepoConfig.init(environment, MapperConfig.PROPERTY_PREFIX)
			);
		} catch (NoSuchElementException e) {
			e.printStackTrace();
		}
		return null;
	}
}
```

@ConditionalOnPropertyForList Annotation은 Prefix를 통해 Environment에 Property가 있는지를 판단하기 위해
작성한 Custom Annotation이다. 본 예제의 코드를 공용 모듈로 활용한다면, Data Source를 사용하지 않을 경우
어플리케이션 실행간 오류가 발생할 수 있기 때문에 이러한 경우에는 Bean을 생성하지 않도록 추가하였다.

Annotation의 코드는 아래와 같다.
```java
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.TYPE, ElementType.METHOD})
@Documented
@Conditional({ConditionalOnPropertyForList.OnPropertyCondition.class})
public @interface ConditionalOnPropertyForList {
	String prefix() default "";

	class OnPropertyCondition implements Condition {

		@Override
		public boolean matches(ConditionContext conditionContext, AnnotatedTypeMetadata metadata) {
			String prefix = (String) Objects.requireNonNull(metadata.getAnnotationAttributes(
					ConditionalOnPropertyForList.class.getName()
			)).get("prefix");

			RepoConfig repoConfig = Binder.get(conditionContext.getEnvironment())
					.bind(prefix, RepoConfig.class)
					.orElse(new RepoConfig());

			return !repoConfig.isEmpty();
		}
	}
}
```

## 정리

이번 포스팅의 핵심은 PostProcessor를 통해 Bean의 Instance화 이전에 Bean을 주입하고, 그에 따라 MyBatis를 사용함에 있어
보다 간결한 개발환경을 구축할 수 있다. 일 것 같다.

본 포스팅에서 다룬 코드는 아래의 Github Repository에서 확인이 가능하다.<br>
동적 Bean을 생성하기 위해서 몇번의 시행착오를 겪었으며, 이로 인해 Spring의 IoC / DI에 대한 심도있는
학습이 필요함을 새삼 깨달았다. 여기에서는 간단하게 다루었지만, 이에 대한 내용 또한 별도의 포스팅을 통해 정리해볼 예정이다.

**[정리예정]**
* Spring Bean Life Cycle
* Custom Conditional Annotation
* Spring Boot Auto Configuration</textarea>
<!-- // SlideShow Information -->
<div id="main" role="main">
  


  
  <article class="page no-author" itemscope itemtype="https://schema.org/CreativeWork">
  

  <!--<article class="page" itemscope itemtype="https://schema.org/CreativeWork">-->
    <meta itemprop="headline" content="다중 데이터 소스를 통한 동적 MyBatis Mapper Scanner 생성">
    <meta itemprop="description" content="어플리케이션을 개발하다보면 다중 Data Source를 사용해야 하는 경우가 생각보다 많다.일반적으로 MyBatis를 통해 Database 개발을 하기 위해서는 보통은 다음과 같은 절차를 통해 개발을 진행한다.  Data Source 정의  SessionFactory / SessionTemplate 정의 - 선언한 Data Source 연결  TransactionManager 정의 - 선언한 Data Source 연결  Mapper Interface를 통해 Database 사용">
    <meta itemprop="datePublished" content="2020-08-04T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header style="padding-bottom: 25px;">
          <h1 id="page-title" class="page__title" itemprop="headline">다중 데이터 소스를 통한 동적 MyBatis Mapper Scanner 생성
</h1>
          
            <p class="page__meta">
              <i class="far fa-clock" aria-hidden="true"></i> 2020/08/04
              
              
              
              
              <i class="category__link">in <a href="/blog/category/server-side">Server-Side</a></i>
            </p>
          
        </header>
      
      <span class="page-divider">
        <span class="one"></span>
        <span class="two"></span>
      </span>
      <ul class="page-tag-list">
        <strong><i class="fas fa-fw fa-tags" aria-hidden="true" style="font-size: .7em"></i>
        
        
        <li><a href="/blog/tag/springboot">#SpringBoot</a></li>
        
        
        <li><a href="/blog/tag/mybatis">#MyBatis</a></li>
        
          <a href="http://hits.dwyl.com/ysjee141.github.ioserver-sideDynamicMyBatisMapperScanner" target="_blank"  class="page__meta__hits">
            <img src="http://hits.dwyl.com/ysjee141.github.ioserver-sideDynamicMyBatisMapperScanner.svg" />
          </a>
      </ul>

      <section class="page__content" itemprop="text">
        
        <p>어플리케이션을 개발하다보면 다중 Data Source를 사용해야 하는 경우가 생각보다 많다.<br />
일반적으로 MyBatis를 통해 Database 개발을 하기 위해서는 보통은 다음과 같은 절차를 통해 개발을 진행한다.</p>
<ol>
  <li>Data Source 정의</li>
  <li>SessionFactory / SessionTemplate 정의 - 선언한 Data Source 연결</li>
  <li>TransactionManager 정의 - 선언한 Data Source 연결</li>
  <li>Mapper Interface를 통해 Database 사용</li>
</ol>

<p>Data Source가 추가되면 위 절차와 같은 작업을 반복해서 설정한다. 이러한 과정은 의외로 귀찮고, 불편한 작업이다.
이를 해결하기 위해서 DataSource 정의만을 통해 위 작업을 자동화 하는 것을 시도해보았다.</p>

<h2 id="핵심">핵심</h2>

<p>동적 Bean 생성의 핵심은 언제 Bean을 생성하여 등록할 것인가? 일 것이다. 동적 Bean을 생성하기 위해서는 아래와 같은 다양한 방법이 있다.</p>
<ul>
  <li>Bean Hooker Interface
    <ul>
      <li>BeanDefinitionRegistryPostProcessor: Bean 정의를 등록하는 것에 초점이 맞춰진 Interface</li>
      <li>BeanFactoryPostProcessor: 빈 정의 자체를 재정의하거나 Property를 추가하기 위해 사용</li>
      <li>BeanPostProcessor: Instance 화 된 Bean을 변경을 하기 위해 사용<br />
  ※ <code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>,<code class="language-plaintext highlighter-rouge">BeanFactoryPostProcessor</code>는 Bean이 Instance 화 되기 전에 호출됨</li>
    </ul>
  </li>
  <li>Application Context Event
    <ul>
      <li>ContextRefreshedEvent: ApplicationContext를 초기화 하거나, Refresh 할 경우 발생</li>
      <li>ContextStartedEvent: ApplicationContext를 start()하여 LifeCycle이 시작되는 시점에 발생</li>
      <li>ContextStoppedEvent: ApplicationContext를 stop()하여 LifeCycle이 정지되는 시점에 발생</li>
      <li>ContextClosedEvent: ApplicationContext를 close()하여 LifeCycle이 종료되는 시점에 발생</li>
    </ul>
  </li>
</ul>

<p>이번 포스팅에서는 <code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>를 활용하여 진행할 생각이다.</p>

<p><code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>는 아래와 같이 사용이 가능하며, 
자세한 내용은 <a href="/blog/server-side/BeanDefinitionPostProcessor/" target="_blank">‘BeanDefinitionRegistryPostProcessor의 사용’</a>을 통해
확인할 수 있다. (아직 많은 부분의 수정이 필요하지만…)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapperBeanPostProcessor</span> <span class="kd">implements</span> <span class="nc">BeanDefinitionRegistryPostProcessor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postProcessBeanDefinitionRegistry</span><span class="o">(</span><span class="nc">BeanDefinitionRegistry</span> <span class="n">beanFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
        <span class="c1">// BeanDefinition을 통해 Bean을 추가할 경우 이용</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postProcessBeanFactory</span><span class="o">(</span><span class="nc">ConfigurableListableBeanFactory</span> <span class="n">configurableListableBeanFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
        <span class="c1">// SingleTone Bean을 추가할 경우 이용</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="구현">구현</h2>

<h3 id="data-source-property-class">Data Source Property Class</h3>

<p>이번 포스팅에서 다룰 예제는 정의된 Data Source를 통해 동적 Bean을 생성하는 것이다. 따라서 Data Source를 정의하기 위한
방법이 필요하며, 다중 Data Source의 정의가 가능해야 하기 때문에 아래와 같이 List 형식의 Property Class를 작성한다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RepoConfig</span> <span class="kd">extends</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">RepoConfig</span><span class="o">.</span><span class="na">DsConfig</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">RepoConfig</span> <span class="nf">init</span><span class="o">(</span><span class="nc">Environment</span> <span class="n">environment</span><span class="o">,</span> <span class="nc">String</span> <span class="n">prefix</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Binder</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">environment</span><span class="o">).</span><span class="na">bind</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DsConfig</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">dataSource</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">MapperOrder</span> <span class="n">order</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">MapperOrder</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrder</span><span class="o">(</span><span class="nc">MapperOrder</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">order</span> <span class="o">=</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">(</span><span class="no">BEAN_TYPE</span> <span class="n">beanType</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="n">beanType</span><span class="o">.</span><span class="na">getSuffix</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMapperLocation</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="s">"classpath*:/mapper/"</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">+</span> <span class="s">"/*.xml"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getDataSource</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDataSource</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>는 위에서 설명한바와 같이 Bean Instance화 되기 전에 호출이 되기 때문에,
<code class="language-plaintext highlighter-rouge">@ConfigurationProperties</code> Annotation을 통해 Property를 가져와 사용할 수가 없었다.
따라서 Processor Bean 생성시 Environment를 전달받아 prefix를 통해 직접 Property를 가져와 Binding하도록 하였다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="nc">RepoConfig</span> <span class="nf">init</span><span class="o">(</span><span class="nc">Environment</span> <span class="n">environment</span><span class="o">,</span> <span class="nc">String</span> <span class="n">prefix</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Binder</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">environment</span><span class="o">).</span><span class="na">bind</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<p>물론 Processor가 아닌 다른 서비스 로직에서 사용하기 위해서는 AutoConfiguration으로 설정하여 사용도 가능하다.</p>

<p>실제 Data Source 정보를 저장하기 위해서 내부에 Sub Class를 생성하고, Property Class는 ArrayList<T>를 상속 받고, 
Generic을 Sub Class로 지정하였다. 다음과 같이 YAML 또는 Properties 파일애 Data Source 정보를 설정하면, 
Property Class에 정보가 주입된다.</T></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">datasource3</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">datasourceOne</span>
    <span class="na">order</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">data-source</span><span class="pi">:</span>
      <span class="na">jdbcUrl</span><span class="pi">:</span> <span class="s">jdbc:h2:file:d:/test_db;AUTO_SERVER=TRUE</span>
      <span class="na">username</span><span class="pi">:</span> <span class="s">test</span>
      <span class="na">password</span><span class="pi">:</span> <span class="s">test</span>
      <span class="na">driverClassName</span><span class="pi">:</span> <span class="s">org.h2.Driver</span>
      <span class="na">maximumPoolSize</span><span class="pi">:</span> <span class="m">20</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Annotation을 통한 Property 주입</span>
<span class="nd">@Bean</span>
<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"datasource"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">RepoConfig</span> <span class="nf">getConfig</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">RepoConfig</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// RepoConfig.init() Method를 통해 주입</span>
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">RepoConfig</span> <span class="nf">getConfig</span><span class="o">(</span><span class="nc">Environment</span> <span class="n">env</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="s">"datasource3"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="beandefinitionregistrypostprocessor">BeanDefinitionRegistryPostProcessor</h3>

<p><code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code> 사용한 결정적인 이유는 어플리케이션 내 <code class="language-plaintext highlighter-rouge">@MapperScan</code> Annotation을 선언하지 않고,
Mapper Interface 들을 Scan 하기 위함이다. PostProcessor가 아닌 Application Context Event Listener를 통해 기능을 구현하였더니,
Bean Instance 화 과정에서 Mapper Interface를 Autowired 하는 과정에서 오류가 발생하고, 어플리케이션이 종료되었다.</p>

<p>이에 Bean Instance 화 이전에 MapperScanner를 생성하여, Mapper Interface를 Scan 하기 위해 PostProcessor를 이용하니,
위와 같은 문제가 해결되었다.</p>

<p>PostProcessor는 아래와 같이 개발할 수 있다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapperBeanPostProcessor</span> <span class="kd">implements</span> <span class="nc">BeanDefinitionRegistryPostProcessor</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">RepoConfig</span> <span class="n">repo</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">MapperBeanPostProcessor</span><span class="o">(</span><span class="nc">RepoConfig</span> <span class="n">repo</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">repo</span> <span class="o">=</span> <span class="n">repo</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postProcessBeanDefinitionRegistry</span><span class="o">(</span><span class="nc">BeanDefinitionRegistry</span> <span class="n">beanFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
		<span class="n">repo</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="n">registerDataSource</span><span class="o">(</span><span class="n">beanFactory</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>         <span class="c1">// DataSource 등록</span>
			<span class="n">registerSqlSessionFactory</span><span class="o">(</span><span class="n">beanFactory</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>  <span class="c1">// SqlSessionFactory</span>
			<span class="n">registerSqlSessionTemplate</span><span class="o">(</span><span class="n">beanFactory</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span> <span class="c1">// SqlSessionTemplate</span>
			<span class="n">registerTransactionManager</span><span class="o">(</span><span class="n">beanFactory</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span> <span class="c1">// TransactionManager</span>
			<span class="n">registerMapperScanner</span><span class="o">(</span><span class="n">beanFactory</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>      <span class="c1">// MapperScannerConfigurer</span>
		<span class="o">});</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postProcessBeanFactory</span><span class="o">(</span><span class="nc">ConfigurableListableBeanFactory</span> <span class="n">configurableListableBeanFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
    <span class="o">}</span>

	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">registerDataSource</span><span class="o">(</span>
			<span class="nc">BeanDefinitionRegistry</span> <span class="n">registry</span><span class="o">,</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">DsConfig</span> <span class="n">config</span>
	<span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Data Source Bean 등록</span>
        <span class="c1">// Bean 생성 및 등록 Sample Code </span>
        <span class="nc">GenericBeanDefinition</span> <span class="n">dataSourceBeanDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericBeanDefinition</span><span class="o">();</span>
        <span class="n">dataSourceBeanDefinition</span><span class="o">.</span><span class="na">setBeanClass</span><span class="o">(</span><span class="nc">HikariDataSource</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dataSourceBeanDefinition</span><span class="o">.</span><span class="na">setPropertyValues</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">MutablePropertyValues</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">getDataSource</span><span class="o">())</span>
        <span class="o">);</span>

        <span class="n">registry</span><span class="o">.</span><span class="na">registerBeanDefinition</span><span class="o">(</span>
            <span class="n">config</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="nc">RepoConfig</span><span class="o">.</span><span class="na">BEAN_TYPE</span><span class="o">.</span><span class="na">DATASOURCE</span><span class="o">),</span>
            <span class="n">dataSourceBeanDefinition</span>
        <span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">registerSqlSessionFactory</span><span class="o">(</span><span class="nc">BeanDefinitionRegistry</span> <span class="n">registry</span><span class="o">,</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">DsConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// SessionFactory Bean 등록</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">registerSqlSessionTemplate</span><span class="o">(</span><span class="nc">BeanDefinitionRegistry</span> <span class="n">registry</span><span class="o">,</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">DsConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// SessionTemplate Bean 등록</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">registerTransactionManager</span><span class="o">(</span><span class="nc">BeanDefinitionRegistry</span> <span class="n">registry</span><span class="o">,</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">DsConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TransactionManager Bean 등록</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">registerMapperScanner</span><span class="o">(</span><span class="nc">BeanDefinitionRegistry</span> <span class="n">registry</span><span class="o">,</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">DsConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// MapperScanner Bean 등록</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="autoconfiguration">AutoConfiguration</h3>

<p><code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>의 사용을 위해서는 PostProcessor 또한 Bean으로 등록해주어야 한다.<br />
아래와 같이 사용이 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ConditionalOnPropertyForList</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="nc">MapperConfig</span><span class="o">.</span><span class="na">PROPERTY_PREFIX</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapperConfig</span> <span class="o">{</span>

	<span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">PROPERTY_PREFIX</span> <span class="o">=</span> <span class="s">"datasource3"</span><span class="o">;</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="nc">BeanDefinitionRegistryPostProcessor</span> <span class="nf">postProcessor</span><span class="o">(</span><span class="nc">Environment</span> <span class="n">environment</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nf">MapperBeanPostProcessor</span><span class="o">(</span>
					<span class="nc">RepoConfig</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">environment</span><span class="o">,</span> <span class="nc">MapperConfig</span><span class="o">.</span><span class="na">PROPERTY_PREFIX</span><span class="o">)</span>
			<span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchElementException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>@ConditionalOnPropertyForList Annotation은 Prefix를 통해 Environment에 Property가 있는지를 판단하기 위해
작성한 Custom Annotation이다. 본 예제의 코드를 공용 모듈로 활용한다면, Data Source를 사용하지 않을 경우
어플리케이션 실행간 오류가 발생할 수 있기 때문에 이러한 경우에는 Bean을 생성하지 않도록 추가하였다.</p>

<p>Annotation의 코드는 아래와 같다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">})</span>
<span class="nd">@Documented</span>
<span class="nd">@Conditional</span><span class="o">({</span><span class="nc">ConditionalOnPropertyForList</span><span class="o">.</span><span class="na">OnPropertyCondition</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">ConditionalOnPropertyForList</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="nf">prefix</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>

	<span class="kd">class</span> <span class="nc">OnPropertyCondition</span> <span class="kd">implements</span> <span class="nc">Condition</span> <span class="o">{</span>

		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="nc">ConditionContext</span> <span class="n">conditionContext</span><span class="o">,</span> <span class="nc">AnnotatedTypeMetadata</span> <span class="n">metadata</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">String</span> <span class="n">prefix</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">metadata</span><span class="o">.</span><span class="na">getAnnotationAttributes</span><span class="o">(</span>
					<span class="nc">ConditionalOnPropertyForList</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span>
			<span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="s">"prefix"</span><span class="o">);</span>

			<span class="nc">RepoConfig</span> <span class="n">repoConfig</span> <span class="o">=</span> <span class="nc">Binder</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">conditionContext</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">())</span>
					<span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="nc">RepoConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
					<span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="k">new</span> <span class="nc">RepoConfig</span><span class="o">());</span>

			<span class="k">return</span> <span class="o">!</span><span class="n">repoConfig</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="정리">정리</h2>

<p>이번 포스팅의 핵심은 PostProcessor를 통해 Bean의 Instance화 이전에 Bean을 주입하고, 그에 따라 MyBatis를 사용함에 있어
보다 간결한 개발환경을 구축할 수 있다. 일 것 같다.</p>

<p>본 포스팅에서 다룬 코드는 아래의 Github Repository에서 확인이 가능하다.<br />
동적 Bean을 생성하기 위해서 몇번의 시행착오를 겪었으며, 이로 인해 Spring의 IoC / DI에 대한 심도있는
학습이 필요함을 새삼 깨달았다. 여기에서는 간단하게 다루었지만, 이에 대한 내용 또한 별도의 포스팅을 통해 정리해볼 예정이다.</p>

<p><strong>[정리예정]</strong></p>
<ul>
  <li>Spring Bean Life Cycle</li>
  <li>Custom Conditional Annotation</li>
  <li>Spring Boot Auto Configuration</li>
</ul>

        

        
        <span class="page-divider" style="margin-top: 50px;">
          <span class="one"></span>
          <span class="two"></span>
        </span>
        <table class="page__meta__additional">
          
          <tr>
            <th>예제코드</th>
            <td>
              ※ 본 포스팅의 코드는 GitHub에서 확인할 수 있습니다.<br>
              <a href="https://github.com/ysjee141/dynamic-mapper-scanner" class="page__meta__github" target="_blank">https://github.com/ysjee141/dynamic-mapper-scanner</a>
            </td>
          </tr>
          
          
          <tr>
            <th>참고자료</th>
            <td>
              <ul>
                
                
                <li><a href="https://thecodinglog.github.io/spring/2019/01/29/dynamic-spring-bean-registration.html" target="_blank">https://thecodinglog.github.io/spring/2019/01/29/dynamic-spring-bean-registration.html</a></li>
                
                
                
                <li><a href="http://wiki.sys4u.co.kr/pages/viewpage.action?pageId=7767258" target="_blank">http://wiki.sys4u.co.kr/pages/viewpage.action?pageId=7767258</a></li>
                
                
              </ul>
            </td>
          </tr>
          
        </table>
        

      </section>

      

      
  <nav class="pagination">
    
      <a href="/blog/server-side/BeanDefinitionPostProcessor/" class="pagination--pager" title="BeanDefinitionRegistryPostProcessor의 사용
">< PREVIOUS POST</a>
    
    
      <a href="/blog/dev%20tools/intellij-springboot-docker/" class="pagination--pager" title="Spring Boot를 Docker 환경으로 개발/디버깅 하기
">NEXT POST ></a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">댓글 남기기</h4>
      <section id="utterances-comments"></section>
    
</div>

    
  </article>

  
  
    
      <div class="page__related no-author">
    
    <!--<div class="page__related">-->
      <h4 class="page__related-title">참고</h4>
      <div class="grid__wrapper">
        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/server-side/java-enum-functional/" rel="permalink">enum 보다 잘 활용하기
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/09/03
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">개발을 진행하다보면, 정해진 코드 값이나 패턴 등 정형화된 케이스에 대한 처리가 이루어지는 경우가 많다.
이러한 경우 보통 enum을 활용하는데, 이번 포스트는 이번에 알게되었고, 사용한 enum의 활용법에 이야기 해보려 한다.
</p>
    
    
    
    <a href="/blog/tag/java" class="page__meta__tag">#Java</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/dev%20tools/intellij-springboot-docker/" rel="permalink">Spring Boot를 Docker 환경으로 개발/디버깅 하기
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/08/19
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">Spring Boot를 Docker 환경에서 개발 및 디버깅을 하기 위한 방법을 정리한다.
</p>
    
    
    
    <a href="/blog/tag/springboot" class="page__meta__tag">#SpringBoot</a>
    
    
    
    <a href="/blog/tag/intellij" class="page__meta__tag">#IntelliJ</a>
    
    
    
    <a href="/blog/tag/devtools" class="page__meta__tag">#Devtools</a>
    
    
    
    <a href="/blog/tag/docker" class="page__meta__tag">#Docker</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/server-side/BeanDefinitionPostProcessor/" rel="permalink">BeanDefinitionRegistryPostProcessor의 사용
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/08/03
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">Spring에서 어플리케이션이 시작될 때 동적으로 Bean을 생성하기 위해서는 다양한 방법이 존재한다.
앞서에는 Application Context 의 Event Listener를 통해 동적 Bean을 생성하는 방법을 소개한 적이 있는데, 
이번에는  BeanDefinitionRe...</p>
    
    
    
    <a href="/blog/tag/springboot" class="page__meta__tag">#SpringBoot</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/my%20story/my-story/" rel="permalink">블로그를 시작하며…
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/07/29
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">요즘 개발자들은 누구라 할 것 없이 블로그를 하는 것 같습니다.
덕분에 참고할 자료가 많아져서 개발하기가 많이 수월해졌고 저 또한 
이러한 블로그들을 참고하면서 개발을 진행하고, 지식을 습득하고 있습니다.
</p>
    
    
    
    <a href="/blog/tag/my%20story" class="page__meta__tag">#My Story</a>
    
  </article>
</div>

        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="검색어를 입력하세요..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow" style="display: inline-block">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/ysjee141" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://instagram.com/ysjee141" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright" style="display: inline-block">&copy; 2020 HAPPL. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>




<script src="/blog/assets/js/lunr/lunr.min.js"></script>
<script src="/blog/assets/js/lunr/lunr-store.js"></script>
<script src="/blog/assets/js/lunr/lunr-en.js"></script>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162766344-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-162766344-1');
</script>


    <style>
    .utterances {
        width: 100%;
        max-width: none;
    }
</style>
<script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'ysjee141/blog');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  



<script src="/blog/assets/js/_extend.js"></script>
<script src="/blog/assets/js/vendor/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad:true,
    theme: "forest",
    fontFamily: "D2Coding"
  });
  mermaid.init(undefined, '.language-mermaid');
</script>

  </body>
</html>
