<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>BeanDefinitionRegistryPostProcessor의 사용 - happl’s Doodle</title>
<meta name="description" content="Spring에서 어플리케이션이 시작될 때 동적으로 Bean을 생성하기 위해서는 다양한 방법이 존재한다. 앞서에는 Application Context 의 Event Listener를 통해 동적 Bean을 생성하는 방법을 소개한 적이 있는데,  이번에는  BeanDefinitionRegistryPostProcessor를 통해 동적 Bean을 생성하는 방법을 정리하려 한다.">


  <meta name="author" content="Yoonseong JI">


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="happl's Doodle">
<meta property="og:title" content="BeanDefinitionRegistryPostProcessor의 사용">
<meta property="og:url" content="https://ysjee141.github.io/blog/server-side/BeanDefinitionPostProcessor/">


  <meta property="og:description" content="Spring에서 어플리케이션이 시작될 때 동적으로 Bean을 생성하기 위해서는 다양한 방법이 존재한다. 앞서에는 Application Context 의 Event Listener를 통해 동적 Bean을 생성하는 방법을 소개한 적이 있는데,  이번에는  BeanDefinitionRegistryPostProcessor를 통해 동적 Bean을 생성하는 방법을 정리하려 한다.">







  <meta property="article:published_time" content="2020-08-03T00:00:00+00:00">





  

  


<link rel="canonical" href="https://ysjee141.github.io/blog/server-side/BeanDefinitionPostProcessor/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "happl",
      "url": "https://ysjee141.github.io/blog/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="happl's Doodle Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
<link rel="stylesheet" href="/blog/assets/css/syntax.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    <script src="/blog/assets/js/vendor/jquery/jquery-3.4.1.js"></script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.0/axios.min.js"></script>
  
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
  
    <script src="https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js"></script>
  
    <script src="/blog/assets/js/vendor/bluebird.js"></script>
  


    <!-- start custom head snippets -->
<meta name="google-site-verification" content="SO-0QxMtMMEgiaV3K59vtKNi2ucxcYXH9gROvXDOke0" />
<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          happl's Doodle
          <span class="site-subtitle">심심해서 끄적거리는 낙서장</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              
              <a data-link="Blog" href="/blog/">Blog</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="Tag" href="/blog/tag">Tag</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="Repos" href="/blog/github-repos">Repos</a>
            </li><li class="masthead__menu-item">
              
              <a data-link="About" href="/blog/about">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {

    var _url = window.location.pathname;

    if( _url.indexOf("/tag") > -1 ) {
      $("[data-link='Tag']").addClass("hover");
    } else if( _url.indexOf("/github-repos") > -1 ) {
      $("[data-link='Repos']").addClass("hover");
    } else if( _url.indexOf("/about") > -1 ) {
      $("[data-link='About']").addClass("hover");
    } else {
      $("[data-link='Blog']").addClass("hover");
    }


  })
</script>

    <div class="initial-content">
      


<!--<button type="button" onclick="slideshow('/blog/server-side/BeanDefinitionPostProcessor/')">Slide</button>-->
<!-- SlideShow Information -->

<textarea id="source" style="display: none">Spring에서 어플리케이션이 시작될 때 동적으로 Bean을 생성하기 위해서는 다양한 방법이 존재한다.
앞서에는 Application Context 의 Event Listener를 통해 동적 Bean을 생성하는 방법을 소개한 적이 있는데, 
이번에는  `BeanDefinitionRegistryPostProcessor`를 통해 동적 Bean을 생성하는 방법을 정리하려 한다.

좀 더 자세한 이해가 필요하겠지만, 지금까지 내가 이해한 것으로는 Event Listener를 통해 동적 Bean을 생성하는 것과 
`BeanDefinitionRegistryPostProcessor`를 통해 동적 Bean을 생성하는 것의 결정적인 차이는 생성 시점으로 생각된다.

Application Context의 Event는 생성/갱신/중지/종료 시점에 동작을 하게된다.
반면에 `BeanDefinitionRegistryPostProcessor`는 Spring이 Component Scan을 하기 이전 또는 
실행하면서 발생하는 것이 아닌가 싶다. 이 부분은 자세한 조사를 통해 다시 정리토록 하겠다.

# Code Sample

본 포스트의 주 목적은 'BeanDefinitionRegistryPostProcessor'의 사용이므로, 이 부분에 집중하기로 하자.
아래 예제를 참고하자

```java
public class PostProcessor implements BeanDefinitionRegistryPostProcessor {
	@Override
	public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanFactory) throws BeansException {
		...
	}

	@Override
	public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException {
        ...
	}
}
```
`BeanDefinitionRegistryPostProcessor`를 사용하기 위해서는 인터페이스를 통해 구현 클래스를 개발하면 된다.<br>
Override되어야 하는 함수는 다음과 같다.
* postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanFactory): BeanFactory를 이용하여 빈 정보를 등록하는 경우 이용
* postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory): BeanDefinitionRegistry를 이용하여 빈 정보를 등록하는 경우 이용

# 정리

나의 경우에는 Dynamic Mapper를 구현하는 과정에서 @MapperScan Annotation이 없이 
Custom Annotation을 통해 Mapper Class 들을 Bean으로 등록하여 사용하고자 하는 것이 목적이였다.
그런데 Application Context Event를 통해 이를 구현하였더니, ContextRefreshedEvent는 
이미 Autowired Bean의 등록 및 스캔이 완료된 시점에서 호출이 되는지 @MapperScan이 누락이 되면 
Autowired 설정한 Class를 찾지 못해 오류가 발생하였다.

이러한 상황을 `BeanDefinitionRegistryPostProcessor`를 통해 구현했더니, 위 문제가 해결되었다.

Spring에서 Bean이 등록되고 동작되는 방식에 대한 자세한 학습이 필요할 듯하다...</textarea>
<!-- // SlideShow Information -->
<div id="main" role="main">
  


  
  <article class="page no-author" itemscope itemtype="https://schema.org/CreativeWork">
  

  <!--<article class="page" itemscope itemtype="https://schema.org/CreativeWork">-->
    <meta itemprop="headline" content="BeanDefinitionRegistryPostProcessor의 사용">
    <meta itemprop="description" content="Spring에서 어플리케이션이 시작될 때 동적으로 Bean을 생성하기 위해서는 다양한 방법이 존재한다.앞서에는 Application Context 의 Event Listener를 통해 동적 Bean을 생성하는 방법을 소개한 적이 있는데, 이번에는  BeanDefinitionRegistryPostProcessor를 통해 동적 Bean을 생성하는 방법을 정리하려 한다.">
    <meta itemprop="datePublished" content="2020-08-03T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header style="padding-bottom: 25px;">
          <h1 id="page-title" class="page__title" itemprop="headline">BeanDefinitionRegistryPostProcessor의 사용
</h1>
          
            <p class="page__meta">
              <i class="far fa-clock" aria-hidden="true"></i> 2020/08/03
              
              
              
              
              <i class="category__link">in <a href="/blog/category/server-side">Server-Side</a></i>
            </p>
          
        </header>
      
      <span class="page-divider">
        <span class="one"></span>
        <span class="two"></span>
      </span>
      <ul class="page-tag-list">
        <strong><i class="fas fa-fw fa-tags" aria-hidden="true" style="font-size: .7em"></i>
        
        
        <li><a href="/blog/tag/springboot">#SpringBoot</a></li>
        
          <a href="http://hits.dwyl.com/ysjee141.github.ioserver-sideBeanDefinitionPostProcessor" target="_blank"  class="page__meta__hits">
            <img src="http://hits.dwyl.com/ysjee141.github.ioserver-sideBeanDefinitionPostProcessor.svg" />
          </a>
      </ul>

      <section class="page__content" itemprop="text">
        
        <p>Spring에서 어플리케이션이 시작될 때 동적으로 Bean을 생성하기 위해서는 다양한 방법이 존재한다.
앞서에는 Application Context 의 Event Listener를 통해 동적 Bean을 생성하는 방법을 소개한 적이 있는데, 
이번에는  <code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>를 통해 동적 Bean을 생성하는 방법을 정리하려 한다.</p>

<p>좀 더 자세한 이해가 필요하겠지만, 지금까지 내가 이해한 것으로는 Event Listener를 통해 동적 Bean을 생성하는 것과 
<code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>를 통해 동적 Bean을 생성하는 것의 결정적인 차이는 생성 시점으로 생각된다.</p>

<p>Application Context의 Event는 생성/갱신/중지/종료 시점에 동작을 하게된다.
반면에 <code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>는 Spring이 Component Scan을 하기 이전 또는 
실행하면서 발생하는 것이 아닌가 싶다. 이 부분은 자세한 조사를 통해 다시 정리토록 하겠다.</p>

<h1 id="code-sample">Code Sample</h1>

<p>본 포스트의 주 목적은 ‘BeanDefinitionRegistryPostProcessor’의 사용이므로, 이 부분에 집중하기로 하자.
아래 예제를 참고하자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostProcessor</span> <span class="kd">implements</span> <span class="nc">BeanDefinitionRegistryPostProcessor</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postProcessBeanDefinitionRegistry</span><span class="o">(</span><span class="nc">BeanDefinitionRegistry</span> <span class="n">beanFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
		<span class="o">...</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postProcessBeanFactory</span><span class="o">(</span><span class="nc">ConfigurableListableBeanFactory</span> <span class="n">configurableListableBeanFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
        <span class="o">...</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>를 사용하기 위해서는 인터페이스를 통해 구현 클래스를 개발하면 된다.<br />
Override되어야 하는 함수는 다음과 같다.</p>
<ul>
  <li>postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanFactory): BeanFactory를 이용하여 빈 정보를 등록하는 경우 이용</li>
  <li>postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory): BeanDefinitionRegistry를 이용하여 빈 정보를 등록하는 경우 이용</li>
</ul>

<h1 id="정리">정리</h1>

<p>나의 경우에는 Dynamic Mapper를 구현하는 과정에서 @MapperScan Annotation이 없이 
Custom Annotation을 통해 Mapper Class 들을 Bean으로 등록하여 사용하고자 하는 것이 목적이였다.
그런데 Application Context Event를 통해 이를 구현하였더니, ContextRefreshedEvent는 
이미 Autowired Bean의 등록 및 스캔이 완료된 시점에서 호출이 되는지 @MapperScan이 누락이 되면 
Autowired 설정한 Class를 찾지 못해 오류가 발생하였다.</p>

<p>이러한 상황을 <code class="language-plaintext highlighter-rouge">BeanDefinitionRegistryPostProcessor</code>를 통해 구현했더니, 위 문제가 해결되었다.</p>

<p>Spring에서 Bean이 등록되고 동작되는 방식에 대한 자세한 학습이 필요할 듯하다…</p>

        

        

      </section>

      

      
  <nav class="pagination">
    
      <a href="/blog/my%20story/my-story/" class="pagination--pager" title="블로그를 시작하며…
">이전</a>
    
    
      <a href="/blog/server-side/DynamicMyBatisMapperScanner/" class="pagination--pager" title="다중 데이터 소스를 통한 동적 MyBatis Mapper Scanner 생성
">다음</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">댓글 남기기</h4>
      <section id="utterances-comments"></section>
    
</div>

    
  </article>

  
  
    
      <div class="page__related no-author">
    
    <!--<div class="page__related">-->
      <h4 class="page__related-title">참고</h4>
      <div class="grid__wrapper">
        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/server-side/DynamicMyBatisMapperScanner/" rel="permalink">다중 데이터 소스를 통한 동적 MyBatis Mapper Scanner 생성
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/08/04
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">어플리케이션을 개발하다보면 다중 Data Source를 사용해야 하는 경우가 생각보다 많다.
일반적으로 MyBatis를 통해 Database 개발을 하기 위해서는 보통은 다음과 같은 절차를 통해 개발을 진행한다.

  Data Source 정의
  SessionFactory / S...</p>
    
    
    
    <a href="/blog/tag/springboot" class="page__meta__tag">#SpringBoot</a>
    
    
    
    <a href="/blog/tag/mybatis" class="page__meta__tag">#MyBatis</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/my%20story/my-story/" rel="permalink">블로그를 시작하며…
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/07/29
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">요즘 개발자들은 누구라 할 것 없이 블로그를 하는 것 같습니다.
덕분에 참고할 자료가 많아져서 개발하기가 많이 수월해졌고 저 또한 
이러한 블로그들을 참고하면서 개발을 진행하고, 지식을 습득하고 있습니다.
</p>
    
    
    
    <a href="/blog/tag/my%20story" class="page__meta__tag">#My Story</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/quality/java-benchmark/" rel="permalink">JMH(Java Microbenchmark Harness) 사용법
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/07/29
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">개발을 진행하다가 보면, 성능문제를 해결해야 하는 경우는 매우 많다. 성능 문제를 해결하기 위해서는 우선 성능을 측정해야하며, 성능을 측정하는 방법와 도구는 셀수도 없이 많다.
대부분의 경우 개발환경 또는 운영환경에 어플리케이션이 배포가 되고, Stress Test를 진행하여 성능...</p>
    
    
    
    <a href="/blog/tag/java" class="page__meta__tag">#Java</a>
    
    
    
    <a href="/blog/tag/benchmark" class="page__meta__tag">#Benchmark</a>
    
    
    
    <a href="/blog/tag/jmh" class="page__meta__tag">#JMH</a>
    
    
    
    <a href="/blog/tag/performance" class="page__meta__tag">#Performance</a>
    
  </article>
</div>

        
          
  
    
  




<div class="grid__item">

    
    <article class="archive__item no-margin" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/server-side/ContextRefreshedEvent/" rel="permalink">Spring Boot Application Context Event
</a>
      
    </h3>
    
    <p class="page__meta">
        <i class="far fa-clock" aria-hidden="true"></i> 2020/07/28
    </p>
    
    <p class="archive__item-excerpt" itemprop="description">[상황]

  어플리케이션을 개발하다보니 다중 Data Source의 사용이 필요하다.

  먼저 Data Source를 정의하고, Data Source와 연결되는 SessionFactory, SessionTemplate, TransactionManager를
각각 정의해서 개발환경...</p>
    
    
    
    <a href="/blog/tag/springboot" class="page__meta__tag">#SpringBoot</a>
    
  </article>
</div>

        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="검색어를 입력하세요..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow" style="display: inline-block">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/ysjee141" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://instagram.com/ysjee141" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright" style="display: inline-block">&copy; 2020 HAPPL. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>




<script src="/blog/assets/js/lunr/lunr.min.js"></script>
<script src="/blog/assets/js/lunr/lunr-store.js"></script>
<script src="/blog/assets/js/lunr/lunr-en.js"></script>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162766344-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-162766344-1');
</script>


    <style>
    .utterances {
        width: 100%;
        max-width: none;
    }
</style>
<script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'ysjee141/blog');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  



<script src="/blog/assets/js/_extend.js"></script>
<script src="/blog/assets/js/vendor/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad:true,
    theme: "forest",
    fontFamily: "D2Coding"
  });
  mermaid.init(undefined, '.language-mermaid');
</script>

  </body>
</html>
